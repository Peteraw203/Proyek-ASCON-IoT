{"version":3,"file":"ascon-js.umd.js","sources":["../src/helper.ts","../src/ascon.ts"],"sourcesContent":["import type {\n  AsconEncryptionVariant,\n  AsconHashVariant,\n  BytesLike,\n} from \"./interfaces\";\n\n/**\n * Assert that the variant is a valid Ascon variant.\n * @param variant The variant to assert.\n */\nexport function assertVariant(\n  variant: string\n): asserts variant is AsconEncryptionVariant {\n  if (![\"Ascon-128\", \"Ascon-128a\", \"Ascon-80pq\"].includes(variant)) {\n    throw new Error(\n      `Invalid Ascon variant. \"${variant}\" is not a valid Ascon variant out of \"Ascon-128\", \"Ascon-128a\", \"Ascon-80pq\".`\n    );\n  }\n}\n\nexport function assertHashVariant(\n  variant: string\n): asserts variant is AsconHashVariant {\n  if (\n    ![\"Ascon-Hash\", \"Ascon-Hasha\", \"Ascon-Xof\", \"Ascon-Xofa\"].includes(variant)\n  ) {\n    throw new Error(\n      `Invalid Ascon hash variant. \"${variant}\" is not a valid Ascon hash variant out of \"Ascon-Hash\", \"Ascon-Hasha\", \"Ascon-Xof\", \"Ascon-Xofa\".`\n    );\n  }\n}\n\n/**\n * Assert that the key and nonce are of the correct length.\n * @param key The key to assert.\n * @param nonce The nonce to assert.\n * @param variant The used variant.\n */\nexport function assertLength(\n  key: BytesLike,\n  nonce: BytesLike,\n  variant: AsconEncryptionVariant\n) {\n  // Check the correct nonce length.\n  if (nonce.length != 16) {\n    throw new Error(\n      `Invalid nonce length. Received ${nonce.length} bytes but expected 16 bytes.`\n    );\n  }\n\n  // Check the correct key length.\n  if (!(key.length == 16 || (key.length == 20 && variant == \"Ascon-80pq\"))) {\n    throw new Error(\n      `Invalid key length. Received ${key.length} bytes but expected ${\n        variant == \"Ascon-80pq\" ? 20 : 16\n      } bytes.`\n    );\n  }\n\n  return true;\n}\n\nexport function assertHashLength(\n  hashLength: number,\n  variant: AsconHashVariant\n) {\n  if ([\"Ascon-Hash\", \"Ascon-Hasha\"].includes(variant) && hashLength != 32) {\n    throw new Error(\n      `Invalid hash length. Received ${hashLength} bytes but expected 32 bytes for ${variant}.`\n    );\n  }\n  // else if ([\"Ascon-Xof\", \"Ascon-Xofa\"].includes(variant) && hashLength < 32) {\n  //   throw new Error(\n  //     `Invalid hash length. Received ${hashLength} bytes but expected >= 32 bytes.`\n  //   );\n  // }\n}\n\nexport function toBytes(value: bigint[]): BytesLike {\n  return new BigInt64Array(value);\n}\n\nexport function zeroBytes(length: number): BytesLike {\n  return new BigInt64Array(length);\n}\n\nexport function concatArrays(...arrays: BytesLike[]): BytesLike {\n  const totalLength = arrays.reduce((acc, val) => acc + val.length, 0);\n  const result = new BigInt64Array(totalLength);\n  let offset = 0;\n\n  for (const array of arrays) {\n    result.set(array, offset);\n    offset += array.length;\n  }\n\n  return result;\n}\n\nexport function bytesToInt(bytes: BytesLike): bigint {\n  return bytes.reduce(\n    (acc, bi, i) => acc + (BigInt(bi) << BigInt((bytes.length - 1 - i) * 8)),\n    BigInt(0)\n  );\n}\n\nexport function intToBytes(integer: bigint, nBytes: number): BytesLike {\n  const result: bigint[] = [];\n  for (let i = 0; i < nBytes; i++) {\n    result.push((integer >> BigInt((nBytes - 1 - i) * 8)) & 0xffn);\n  }\n  return new BigInt64Array(result);\n}\n\nexport function bytesToState(bytes: BytesLike): bigint[] {\n  return Array(5)\n    .fill(BigInt(0))\n    .map((_, w) => bytesToInt(bytes.subarray(w * 8, (w + 1) * 8)));\n}\n\nexport function rotr(val: bigint, r: bigint): bigint {\n  return (val >> r) | ((val & ((1n << r) - 1n)) << (64n - r));\n}\n\nexport function arrayEquals(a: BytesLike, b: BytesLike): boolean {\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; i++) {\n    if (a[i] !== b[i]) return false;\n  }\n  return true;\n}\n\nexport function transformArrayBufferToBigInt(array: Uint8Array): BytesLike {\n  return array.reduce((acc, val, i) => {\n    acc[i] = BigInt(val);\n    return acc;\n  }, new BigInt64Array(array.length));\n}\n\nexport function transformBigIntToArrayBufferLike(array: BytesLike): Uint8Array {\n  return array.reduce((acc, val, i) => {\n    acc[i] = Number(val);\n    return acc;\n  }, new Uint8Array(array.length));\n}\n\nexport const randomBytes = (n: number): Uint8Array => {\n  // @ts-ignore\n  if (typeof self !== \"undefined\" && (self.crypto || self.msCrypto)) {\n    // Browsers\n    // @ts-ignore\n    const crypto = self.crypto || self.msCrypto;\n    const QUOTA = 65536;\n    const a = new Uint8Array(n);\n    for (let i = 0; i < n; i += QUOTA) {\n      crypto.getRandomValues(a.subarray(i, i + Math.min(n - i, QUOTA)));\n    }\n    return a;\n  } else {\n    // Node\n    return require(\"crypto\").randomBytes(n);\n  }\n};\n\n/**\n * Convert a buffer to a hex string.\n * @param buffer The buffer to convert.\n * @returns The hex string.\n */\nexport const toHex = (buffer: Uint8Array): string => {\n  return Array.prototype.map\n    .call(buffer, (n) => n.toString(16).padStart(2, \"0\"))\n    .join(\"\");\n};\n\n/**\n * Convert a hex string to a buffer.\n * @param hexString The hex string to convert.\n * @returns The buffer.\n */\nexport const fromHex = (hexString: string) => {\n  return Uint8Array.from(\n    hexString.match(/.{1,2}/g)?.map((byte) => parseInt(byte, 16)) ?? []\n  );\n};\n","import {\n  arrayEquals,\n  assertHashLength,\n  assertHashVariant,\n  assertLength,\n  assertVariant,\n  bytesToInt,\n  bytesToState,\n  concatArrays,\n  intToBytes,\n  rotr,\n  toBytes,\n  transformArrayBufferToBigInt,\n  transformBigIntToArrayBufferLike,\n  zeroBytes,\n} from \"./helper\";\nimport type {\n  AsconEncryptionOptions,\n  AsconHashOptions,\n  BytesLike,\n} from \"./interfaces\";\n\nexport class Ascon {\n  /**\n   * Ascon hash function and extendable-output function.\n   * @param message a Uint8Array of arbitrary length\n   * @param options additional parameters including the variant and the length of the hash\n   *\n   * @returns a Uint8Array containing the hash\n   *\n   * @example\n   * ```typescript\n   * // Normal mode (Ascon-Hash)\n   * const message = new TextEncoder().encode(\"ascon\");\n   * const hash = Ascon.hash(message);\n   * hash // 32 bytes hash\n   *\n   * // XOF mode (Ascon-Xof)\n   * const message = new TextEncoder().encode(\"ascon\");\n   * const hash = Ascon.hash(message, { variant: \"Ascon-Xof\", length: 64 });\n   * hash // 64 bytes hash (default is 32 bytes)\n   * ```\n   */\n  public static hash(\n    message: Uint8Array,\n    options?: AsconHashOptions\n  ): Uint8Array {\n    const bigArray = transformArrayBufferToBigInt(message);\n\n    const variant = options?.variant ?? \"Ascon-Hash\";\n    const hashLength = (options as { length?: number })?.length ?? 32;\n\n    assertHashVariant(variant);\n    assertHashLength(hashLength, variant);\n\n    const a = 12; // rounds\n    const b = [\"Ascon-Hasha\", \"Ascon-Xofa\"].includes(variant) ? 8 : 12;\n    const rate = 8; // bytes\n\n    const tagSpec = intToBytes(\n      [\"Ascon-Hash\", \"Ascon-Hasha\"].includes(variant) ? 256n : 0n,\n      4\n    );\n\n    const S = bytesToState(\n      concatArrays(\n        toBytes([0n, BigInt(rate * 8), BigInt(a), BigInt(a - b)]),\n        tagSpec,\n        zeroBytes(32)\n      )\n    );\n\n    this.permutation(S, a);\n\n    const mPadded = concatArrays(\n      bigArray,\n      toBytes([0x80n]),\n      zeroBytes(rate - (bigArray.length % rate) - 1)\n    );\n\n    // first s - 1 blocks\n    for (let i = 0; i < mPadded.length - rate; i += rate) {\n      S[0] ^= bytesToInt(mPadded.slice(i, i + 8)); // rate = 8\n      this.permutation(S, b);\n    }\n\n    const i = mPadded.length - rate;\n    S[0] ^= bytesToInt(mPadded.slice(i, i + 8)); // rate = 8\n\n    this.permutation(S, a);\n\n    let hash = new BigInt64Array();\n    while (hash.length < hashLength) {\n      hash = concatArrays(hash, intToBytes(S[0], 8)); // rate = 8\n      this.permutation(S, b);\n    }\n\n    return transformBigIntToArrayBufferLike(hash.slice(0, hashLength));\n  }\n\n  /**\n   * Ascon encryption.\n   * @param key a Uint8Array of size 16 (for Ascon-128, Ascon-128a; 128-bit security) or 20 (for Ascon-80pq; 128-bit security)\n   * @param nonce a Uint8Array of size 16 (must not repeat for the same key!)\n   * @param plaintext a Uint8Array of arbitrary length\n   * @param options additional parameters including the variant and associated data as a Uint8Array\n   *\n   * @returns a Uint8Array of length plaintext.length + 16 containing the ciphertext and tag\n   *\n   * @example\n   * ```typescript\n   * const key = new Uint8Array([...]);\n   * const nonce = new Uint8Array([...]);\n   * const plaintext = new TextEncoder().encode(\"ascon\");\n   *\n   * const ciphertext = Ascon.encrypt(key, nonce, plaintext);\n   *\n   * // With associated data\n   * const key = new Uint8Array([...]);\n   * const nonce = new Uint8Array([...]);\n   * const plaintext = new TextEncoder().encode(\"ascon\");\n   * const associatedData = new TextEncoder().encode(\"more data\");\n   *\n   * const ciphertext = Ascon.encrypt(key, nonce, plaintext, { associatedData });\n   * ```\n   */\n  public static encrypt(\n    key: Uint8Array,\n    nonce: Uint8Array,\n    plaintext: Uint8Array,\n    options?: AsconEncryptionOptions\n  ): Uint8Array {\n    const bigKey = transformArrayBufferToBigInt(key);\n    const bigNonce = transformArrayBufferToBigInt(nonce);\n    const bigPlaintext = transformArrayBufferToBigInt(plaintext);\n    const bigAssociatedData = options?.associatedData\n      ? transformArrayBufferToBigInt(options?.associatedData)\n      : undefined;\n\n    const variant = options?.variant ?? \"Ascon-128\";\n    assertVariant(variant);\n    assertLength(bigKey, bigNonce, variant);\n\n    let S = Array(5).fill(BigInt(0));\n    const k = bigKey.length * 8; // bits\n    const a = 12; // rounds\n    const b = variant === \"Ascon-128a\" ? 8 : 6; // rounds\n    const rate = variant === \"Ascon-128a\" ? 16 : 8; // bytes\n\n    S = this.initialize(S, k, rate, a, b, bigKey, bigNonce);\n    this.processAssociatedData(S, b, rate, bigAssociatedData);\n\n    const cipherText = this.processPlaintext(S, b, rate, bigPlaintext);\n    const tag = this.finalize(S, rate, a, bigKey);\n\n    return transformBigIntToArrayBufferLike(concatArrays(cipherText, tag));\n  }\n\n  /**\n   * Ascon decryption.\n   * @param key a Uint8Array of size 16 (for Ascon-128, Ascon-128a; 128-bit security) or 20 (for Ascon-80pq; 128-bit security)\n   * @param nonce a Uint8Array of size 16 (must not repeat for the same key!)\n   * @param ciphertext a Uint8Array of arbitrary length\n   * @param options additional parameters including the variant and associated data as a Uint8Array\n   *\n   * @returns a Uint8Array containing the plaintext or throws when the verification fails\n   * @throws when the verification fails\n   *\n   * @example\n   * ```typescript\n   * const key = new Uint8Array([...]);\n   * const nonce = new Uint8Array([...]);\n   * const ciphertext = new Uint8Array([...]);\n   *\n   * const plaintext = Ascon.decrypt(key, nonce, ciphertext);\n   * plaintext // \"ascon\"\n   *\n   * // With associated data\n   * const key = new Uint8Array([...]);\n   * const nonce = new Uint8Array([...]);\n   * const ciphertext = new Uint8Array([...]);\n   * const associatedData = new TextEncoder().encode(\"more data\");\n   *\n   * const plaintext = Ascon.decrypt(key, nonce, ciphertext, { associatedData });\n   * plaintext // \"ascon\"\n   *\n   * ```\n   */\n  public static decrypt(\n    key: Uint8Array,\n    nonce: Uint8Array,\n    ciphertext: Uint8Array,\n    options?: AsconEncryptionOptions\n  ): Uint8Array {\n    const bigKey = transformArrayBufferToBigInt(key);\n    const bigNonce = transformArrayBufferToBigInt(nonce);\n    const bigCiphertext = transformArrayBufferToBigInt(ciphertext);\n    const bigAssociatedData = options?.associatedData\n      ? transformArrayBufferToBigInt(options?.associatedData)\n      : undefined;\n\n    const variant = options?.variant ?? \"Ascon-128\";\n\n    assertVariant(variant);\n    assertLength(bigKey, bigNonce, variant);\n\n    if (ciphertext.length < 16) {\n      throw new Error(\"Could not be decrypted. Ciphertext too short.\");\n    }\n\n    let S = Array(5).fill(BigInt(0));\n    const k = bigKey.length * 8; // bits\n    const a = 12; // rounds\n    const b = variant === \"Ascon-128a\" ? 8 : 6; // rounds\n    const rate = variant === \"Ascon-128a\" ? 16 : 8; // bytes\n\n    S = this.initialize(S, k, rate, a, b, bigKey, bigNonce);\n    this.processAssociatedData(S, b, rate, bigAssociatedData);\n\n    const plainText = this.processCipherText(\n      S,\n      b,\n      rate,\n      bigCiphertext.slice(0, -16)\n    );\n\n    const tag = this.finalize(S, rate, a, bigKey);\n\n    if (!arrayEquals(tag, bigCiphertext.slice(-16))) {\n      throw new Error(\"Could not be decrypted. Tags don't match.\");\n    }\n\n    return transformBigIntToArrayBufferLike(plainText);\n  }\n\n  private static initialize(\n    S: bigint[],\n    k: number,\n    rate: number,\n    a: number,\n    b: number,\n    key: BytesLike,\n    nonce: BytesLike\n  ) {\n    const iv_zero_key_nonce = concatArrays(\n      toBytes([\n        BigInt(k),\n        BigInt(rate * 8),\n        BigInt(a),\n        BigInt(b),\n        ...new Array(20 - key.length).fill(0n),\n      ]),\n      key,\n      nonce\n    );\n\n    S = S.map((_, i) => bytesToState(iv_zero_key_nonce)[i]);\n\n    // Permute the state.\n    this.permutation(S, a);\n\n    const zeroKey = bytesToState(concatArrays(zeroBytes(40 - key.length), key));\n\n    // Apply the zeroKey to the state.\n    S = S.map((s, i) => s ^ zeroKey[i]);\n\n    return S;\n  }\n\n  private static processAssociatedData(\n    S: bigint[],\n    b: number,\n    rate: number,\n    associatedData: BytesLike | undefined\n  ) {\n    if (associatedData && associatedData.length > 0) {\n      const aZeros = rate - (associatedData.length % rate) - 1;\n      const aPadded = concatArrays(\n        associatedData,\n        toBytes([0x80n]),\n        zeroBytes(Number(aZeros))\n      );\n\n      for (let i = 0; i < aPadded.length; i += Number(rate)) {\n        S[0] ^= bytesToInt(aPadded.slice(i, i + 8));\n        if (rate === 16) {\n          S[1] ^= bytesToInt(aPadded.slice(i + 8, i + 16));\n        }\n\n        this.permutation(S, b);\n      }\n    }\n\n    S[4] ^= 1n;\n  }\n\n  private static processPlaintext(\n    S: bigint[],\n    b: number,\n    rate: number,\n    plaintext: BytesLike\n  ): BytesLike {\n    const pLastLen = plaintext.length % rate;\n    const pPadded = concatArrays(\n      plaintext,\n      toBytes([0x80n]),\n      zeroBytes(rate - pLastLen - 1)\n    );\n\n    let ciphertext = new BigInt64Array();\n    for (let i = 0; i < pPadded.length - rate; i += rate) {\n      if (rate === 8) {\n        S[0] ^= bytesToInt(pPadded.slice(i, i + 8));\n\n        ciphertext = concatArrays(ciphertext, intToBytes(S[0], 8));\n      } else if (rate === 16) {\n        S[0] ^= bytesToInt(pPadded.slice(i, i + 8));\n        S[1] ^= bytesToInt(pPadded.slice(i + 8, i + 16));\n\n        ciphertext = concatArrays(\n          ciphertext,\n          intToBytes(S[0], 8),\n          intToBytes(S[1], 8)\n        );\n      }\n\n      this.permutation(S, b);\n    }\n\n    // last block t\n    const i = pPadded.length - rate;\n    if (rate === 8) {\n      S[0] ^= bytesToInt(pPadded.slice(i, i + 8));\n\n      ciphertext = concatArrays(\n        ciphertext,\n        intToBytes(S[0], 8).slice(0, pLastLen)\n      );\n    } else if (rate === 16) {\n      S[0] ^= bytesToInt(pPadded.slice(i, i + 8));\n      S[1] ^= bytesToInt(pPadded.slice(i + 8, i + 16));\n\n      ciphertext = concatArrays(\n        ciphertext,\n        intToBytes(S[0], 8).slice(0, Math.min(8, pLastLen)),\n        intToBytes(S[1], 8).slice(0, Math.max(0, pLastLen - 8))\n      );\n    }\n\n    return ciphertext;\n  }\n\n  private static processCipherText(\n    S: bigint[],\n    b: number,\n    rate: number,\n    ciphertext: BytesLike\n  ) {\n    const cLastLen = ciphertext.length % rate;\n    const cPadded = concatArrays(ciphertext, zeroBytes(rate - cLastLen));\n\n    let plaintext = new BigInt64Array();\n    for (let i = 0; i < cPadded.length - rate; i += rate) {\n      if (rate === 8) {\n        const c = bytesToInt(cPadded.slice(i, i + 8));\n\n        plaintext = concatArrays(plaintext, intToBytes(S[0] ^ c, 8));\n\n        S[0] = c;\n      } else if (rate === 16) {\n        const c0 = bytesToInt(cPadded.slice(i, i + 8));\n        const c1 = bytesToInt(cPadded.slice(i + 8, i + 16));\n\n        plaintext = concatArrays(\n          plaintext,\n          intToBytes(S[0] ^ c0, 8),\n          intToBytes(S[1] ^ c1, 8)\n        );\n\n        S[0] = c0;\n        S[1] = c1;\n      }\n\n      this.permutation(S, b);\n    }\n\n    // last block t\n    const i = cPadded.length - rate;\n    if (rate === 8) {\n      const cPadding = 0x80n << (BigInt(rate - cLastLen - 1) * 8n);\n      const cMask = 0xffffffffffffffffn >> BigInt(cLastLen * 8);\n      const c = bytesToInt(cPadded.slice(i, i + 8));\n\n      plaintext = concatArrays(\n        plaintext,\n        intToBytes(c ^ S[0], 8).slice(0, cLastLen)\n      );\n      S[0] = c ^ (S[0] & cMask) ^ cPadding;\n    } else if (rate === 16) {\n      const cLastLenWord = BigInt(cLastLen % 8);\n      const cPadding = 0x80n << ((8n - cLastLenWord - 1n) * 8n);\n      const cMask = 0xffffffffffffffffn >> (cLastLenWord * 8n);\n      const c0 = bytesToInt(cPadded.slice(i, i + 8));\n      const c1 = bytesToInt(cPadded.slice(i + 8, i + 16));\n\n      plaintext = concatArrays(\n        plaintext,\n        concatArrays(intToBytes(S[0] ^ c0, 8), intToBytes(S[1] ^ c1, 8)).slice(\n          0,\n          cLastLen\n        )\n      );\n\n      if (cLastLen < 8) {\n        S[0] = c0 ^ (S[0] & cMask) ^ cPadding;\n      } else {\n        S[0] = c0;\n        S[1] = c1 ^ (S[1] & cMask) ^ cPadding;\n      }\n    }\n\n    return plaintext;\n  }\n\n  private static finalize(\n    S: bigint[],\n    rate: number,\n    a: number,\n    key: BytesLike\n  ) {\n    const numRate = rate;\n    S[Math.floor(numRate / 8) + 0] ^= bytesToInt(key.slice(0, 8));\n    S[Math.floor(numRate / 8) + 1] ^= bytesToInt(key.slice(8, 16));\n    const pKey = concatArrays(key, zeroBytes(24 - key.length));\n    S[Math.floor(numRate / 8) + 2] ^= bytesToInt(pKey.slice(16));\n\n    this.permutation(S, a);\n\n    S[3] ^= bytesToInt(key.slice(-16, -8));\n    S[4] ^= bytesToInt(key.slice(-8));\n\n    return concatArrays(intToBytes(S[3], 8), intToBytes(S[4], 8));\n  }\n\n  private static permutation(S: bigint[], rounds = 1) {\n    for (let r = 12 - rounds; r < 12; r++) {\n      // add round constants\n      S[2] ^= 0xf0n - BigInt(r) * 0x10n + BigInt(r) * 0x1n;\n\n      // substitution layer\n      S[0] ^= S[4];\n      S[4] ^= S[3];\n      S[2] ^= S[1];\n      const T: bigint[] = [];\n      for (let i = 0; i < 5; i++) {\n        T.push((S[i] ^ 0xffffffffffffffffn) & S[(i + 1) % 5]);\n      }\n      for (let i = 0; i < 5; i++) {\n        S[i] ^= T[(i + 1) % 5];\n      }\n      S[1] ^= S[0];\n      S[0] ^= S[4];\n      S[3] ^= S[2];\n      S[2] ^= 0xffffffffffffffffn;\n\n      // linear diffusion layer\n      S[0] ^= rotr(S[0], 19n) ^ rotr(S[0], 28n);\n      S[1] ^= rotr(S[1], 61n) ^ rotr(S[1], 39n);\n      S[2] ^= rotr(S[2], 1n) ^ rotr(S[2], 6n);\n      S[3] ^= rotr(S[3], 10n) ^ rotr(S[3], 17n);\n      S[4] ^= rotr(S[4], 7n) ^ rotr(S[4], 41n);\n    }\n  }\n}\n"],"names":["assertVariant","variant","assertHashVariant","assertLength","key","nonce","assertHashLength","hashLength","toBytes","value","zeroBytes","length","concatArrays","arrays","totalLength","acc","val","result","offset","array","bytesToInt","bytes","bi","i","intToBytes","integer","nBytes","bytesToState","_","w","rotr","r","arrayEquals","a","b","transformArrayBufferToBigInt","transformBigIntToArrayBufferLike","randomBytes","n","crypto","QUOTA","toHex","buffer","fromHex","hexString","byte","Ascon","message","options","bigArray","rate","tagSpec","S","mPadded","hash","plaintext","bigKey","bigNonce","bigPlaintext","bigAssociatedData","k","cipherText","tag","ciphertext","bigCiphertext","plainText","iv_zero_key_nonce","zeroKey","s","associatedData","aZeros","aPadded","pLastLen","pPadded","cLastLen","cPadded","c","c0","c1","cPadding","cMask","cLastLenWord","numRate","pKey","rounds","T"],"mappings":"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"}